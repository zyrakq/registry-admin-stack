services:
  registry-admin:
    container_name: registry-admin
    image: ${IMAGE:-localhost/registry-admin:latest}
    restart: unless-stopped
    # command: sleep infinity
    environment:
      APP_UID: ${APP_UID:-1001}
      RA_DEBUG: ${RA_DEBUG:-false}
      RA_REGISTRY_HOSTNAME: ${RA_REGISTRY_HOSTNAME:-0.0.0.0}
      RA_REGISTRY_HOST: ${RA_REGISTRY_HOST}
      RA_REGISTRY_PORT: ${RA_REGISTRY_PORT}
      RA_AUTH_TOKEN_SECRET: ${RA_AUTH_TOKEN_SECRET}
      RA_STORE_DB_TYPE: ${RA_STORE_DB_TYPE:-embed}
      RA_STORE_ADMIN_PASSWORD: ${RA_STORE_ADMIN_PASSWORD}
      RA_STORE_EMBED_DB_PATH: ${RA_STORE_EMBED_DB_PATH:-/app/data/store.db}
      RA_REGISTRY_AUTH_TYPE: ${RA_REGISTRY_AUTH_TYPE:-token}
      RA_REGISTRY_ISSUER: ${RA_REGISTRY_ISSUER}
      RA_REGISTRY_SERVICE: ${RA_REGISTRY_SERVICE}
      # cert
      RA_REGISTRY_CERTS_CERT_PATH: ${RA_REGISTRY_CERTS_CERT_PATH:-/app/certs}
      RA_REGISTRY_CERTS_KEY_PATH: ${RA_REGISTRY_CERTS_KEY_PATH:-/app/certs/cert.key}
      RA_REGISTRY_CERTS_PUBLIC_KEY_PATH: ${RA_REGISTRY_CERTS_PUBLIC_KEY_PATH:-/app/certs/cert.pub}
      RA_REGISTRY_CERTS_CA_ROOT_PATH: ${RA_REGISTRY_CERTS_CA_ROOT_PATH:-/app/certs/cert.crt}
      RA_REGISTRY_CERTS_IP: ${RA_REGISTRY_CERTS_IP:-}
      RA_REGISTRY_CERTS_FQDN: ${RA_REGISTRY_CERTS_FQDN}
      RA_REGISTRY_HTTPS_INSECURE: ${RA_REGISTRY_HTTPS_INSECURE:-false}
      RA_REGISTRY_CERTS_CERT_HTTPS: ${RA_REGISTRY_CERTS_CERT_HTTPS}
    logging:
      driver: "json-file"
      options:
        max-size: 10m
        max-file: 3
    volumes:
      - registry-admin-data:/app/data
      - distribution-oidc-certs:/app/certs
    networks:
      - distribution-network
      - registry-admin-workspace-network
volumes:
  registry-admin-data:
    name: registry-admin-data
  distribution-oidc-certs:
    name: ${DISTRIBUTION_CERTS:-distribution-oidc-certs}
    external: true
networks:
  distribution-network:
    external: true
  registry-admin-workspace-network:
    external: true
